### http2 的多路复用

> 在一个连接里，客户端和浏览器都可以同时发送多个请求或响应。采用了数据流，对同一个响应或请求的所有数据包做了一个独一无二的标识，所以可以不用等待发送，两端会根据标识组装数据流,而且不用按照顺序一一对应。

**例如**：在一个 TCP 连接里面服务器同时收到了 A 请求和 B 请求，于是先回应请求 A，结果发现处理过程非常耗时，于是就发送 A 请求已经处理好的部分，接着回应 B 请求，完成后。再发送 A 请求剩下的部分。

- Http1.0:每个 TCP 连接只能发送一个请求。发送数据完毕，连接就关闭。为了解决这个问题，需要使用 keep-alive 这个字段。
- Http1.1:引入了持久连接，即 TCP 连接默认不关闭，可以被多个请求复用，不用声明 keep-alive，在同一个 TCP 连接中可以发送多个请求，但是所有数据通行是按次序进行的。服务器处理完一个回应，才会进行下一个。

### https 握手过程

1. 客户端访问 web 服务器，请求建立 ssl 连接。
2. 服务器收到请求后，将网站的证书传送一份给客户端。
3. 客户端验证证书的颁发机构和过期时间，没有问题则随机生成一个密钥。传送给服务器，服务器利用自己的私钥解密出会话密钥。
4. 服务器与客户端使用秘钥加密传输

##### HTTPS 握手过程中，客户端如何验证证书的合法性

1. 首先浏览器读取证书中的所有者、有效期等信息，校验证书的网站域名，是否于颁发域名一致，校验证书的有效期。
2. 查找操作系统中内置的受信任的发布机构 CA，与服务器发送的相比对。
3. 如果找到，则从操作系统中取出 CA 的公钥（一般会事先在内部植入常用公钥）然后对服务器发送的证书里面的签名进行解密。
4. 使用相同的 hash 算法计算出证书的 hash 值，然后将这个 hash 值与证书中签名做对比，如果一致，则证明合法。
